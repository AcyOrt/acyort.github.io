<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="keywords" content="acyort, nodejs, blog" />
<meta name="description" content="A Node.js blog tool powered by GitHub." />
<link rel="icon" href="/icon.png" />
<link rel="stylesheet" href="/css/style.css" />

  <title>
正则表达式中的向后匹配 - AcyOrt
</title>
</head>

<body>

<div class="main">

<div class="header">
    <div class="center">
        <a class="logo" href="/">AcyOrt</a>

        <div class="menu">
            <div class="menuicon"></div>

            <div class="menuitem">
            
            <a href="/">home</a>
            
            <a href="/about">about</a>
            
            <a href="/">archives</a>
            
            </div>
        </div>
    </div>
</div>




<div id="post" class="center">

    <p class="time">May 15, 2013</p> 

    <h1 class="title">正则表达式中的向后匹配</h1>

    <div class="content"><p><img src="https://f.cloud.github.com/assets/97227/507193/16053648-bd6a-11e2-9d1f-a291aeb01b23.png" alt="screen shot 2013-05-15 at 10 16 17 pm"></p>
<p>正则表达式可以写出复杂的匹配规则，但涉及到反选等需求时，往往不那么得心应手。</p>
<p>比如下面这段文本：</p>
<pre><code class="lang-js"><span class="hljs-selector-tag">var</span> s = 
    <span class="hljs-string">'　　第一集\n'</span> +
    <span class="hljs-string">'　　第一章 始动\n'</span> +
    <span class="hljs-string">'　　“小卫啊，上工了。”工头老李看着一个……\n'</span> +
    <span class="hljs-string">'　　第二章 突破\n'</span> +
    <span class="hljs-string">'　　连续一个星期了，陈卫还是每天……\n'</span> +
    <span class="hljs-string">'　　但让陈卫纳闷不已的是，他现在每天……\n'</span> +
    <span class="hljs-string">'　　第三章 融合\n'</span> +
    <span class="hljs-string">'　　午夜时分，天上挂着一轮明月，……\n'</span>
</code></pre>
<p>想提取其章节信息：</p>
<pre><code>第一集
第一章 始动
第二章 突破
第三章 融合
</code></pre><p>可以很容易写出匹配章节信息的正则表达式：</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> m = s.<span class="hljs-keyword">match</span>(/^\s*第.+[章集].*$/mg)
</code></pre>
<p>得到的结果是：</p>
<pre><code>[
<span class="hljs-string">"　　第一集"</span>, 
<span class="hljs-string">"　　第一章 始动"</span>, 
<span class="hljs-string">"　　第二章 突破"</span>, 
<span class="hljs-string">"　　第三章 融合"</span>
]
</code></pre><p>现在问题反过来，如果我们想提取非章节信息，应该怎么办呢？</p>
<p>目前最直接的做法是，依旧是像上面这样，先得到章节信息，然后逐行替换为空，剩下的自然就是非章节信息了。</p>
<p>有没有办法，直接用正则匹配出非章节信息呢？</p>
<p>这就涉及正则的 Lookaround 问题。在未来的 JS 引擎里，我们可以这样写：</p>
<pre><code>(<span class="hljs-name">?&lt;=^</span>|(<span class="hljs-name">第.+</span>[<span class="hljs-name">章集</span>])).*?(<span class="hljs-name">?=$</span>|(<span class="hljs-name">第.+</span>[<span class="hljs-name">章集</span>]))
</code></pre><p>上面的正则，将会直接匹配出非章节文本，一步就能满足需求。</p>
<p>Lookaround 是 Lookahead 和 Lookbehind 的统称。对于向前匹配（Lookahead）相信大家都有所接触，包括向前正向匹配（Positive Lookahead）和向前负向匹配（Negative Lookahead），语法是 <code>?=</code> 和 <code>?!</code> 。上面的 <code>(?=$|(第.+[章集])</code> 就是向前正向匹配，表示要匹配的字符后面必须是行尾（$）或者是章节标题（<code>第.+[章集]</code>）。</p>
<p>类似的，理解了向前匹配，向后匹配（Lookbehind）就很容易理解了。<code>(?&lt;=^|(第.+[章集]))</code> 表示的含义是要匹配的字符前面必须是行首（<code>^</code>）或者是章节标题（<code>第.+[章集]</code>）。</p>
<p>中间的 <code>.*?</code> 是非贪婪匹配任意字符。结合上面的 Lookaround，在此表达的含义就是匹配所有非章节信息。</p>
<p>注意：几年前，如果你像我一样喜欢看文本小说的话，上面的正则稍加变化，可以用来干不少事情。当时还在用 Windows，我最喜欢 EmEditor，对正则的支持非常完备。使用 EmEditor 的搜索替换，匹配上无敌的正则，可以很方便提取章节信息、以及去除空白行、将章节缩进重新排版等等。</p>
<p>Lookaround 在正则中非常有用，经常可以利用它来完成一些看似不可完成的匹配，合理利用 Lookaround 能让正则如虎添翼。</p>
<p>Lookaround 参考教程：<a href="http://www.regular-expressions.info/lookaround.html">http://www.regular-expressions.info/lookaround.html</a></p>
<p>当然，在 JavaScript 中你目前只能使用 Lookahead，还无法使用 Lookbehind。期待 ES6 的迅速实现与普及。</p>
<p>文 / 玉伯</p>
<p>题图：可爱的龙猫呀。</p>
<hr>
<p>欢迎订阅 WTP（Web 技术与产品交流）微信公众帐号。WTP 关注技术、产品、自由梦，在每个工作日（偶尔休息日）会定期推送一篇原创文字。欢迎扫描二维码订阅：</p>
<p><img src="http://ww4.sinaimg.cn/thumbnail/68361562gw1e2iehwolnpj.jpg" alt=""></p>
</div>

    <div class="cat">
    
    <p><span>#</span> <a href="/category/blog/">blog</a></p>
    
    </div>

    <div class="relate">
        
        
        <p><span>PREV: </span><a rel="prev" href="/posts/14406696.html">Page Visibility 初探</a></p>
        

        
        
        <p><span>NEXT: </span><a rel="next" href="/posts/14309573.html"> 发呆</a></p>
        

        <p><span></span><a rel="all" href="/">View All Posts</a></p>
    </div>

    <div class="comments">
        <div id="disqus_thread"></div>
    </div>

</div>


<div class="footer">
    <div class="center">
        AcyOrt / powered by <a target="_blank" href="https://github.com/AcyOrt/acyort">AcyOrt</a> / <a target="_blank" href="/rss.xml">RSS</a>
    </div>
</div>

<script>

var menu = document.querySelector('.menu');

document.querySelector('.main').addEventListener('click', function(e) {
    if (e.target.classList.toString().indexOf('menuicon') > -1) {
        return menu.classList.toggle('active')
    } 

    return menu.classList.remove('active')
})

</script>




<script>
(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//acyort.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>



</div>

</body>
</html>
