<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="keywords" content="acyort, nodejs, blog" />
<meta name="description" content="A Node.js blog tool powered by GitHub." />
<link rel="icon" href="//icon.png" />
<link rel="stylesheet" href="/css/style.css" />

  <title>
补码之美 - AcyOrt
</title>
</head>

<body>

<div class="main">

<div class="header">
    <div class="center">
        <a class="logo" href="/">AcyOrt</a>

        <div class="menu">
            <div class="menuicon"></div>

            <div class="menuitem">
            
            <a href="/">home</a>
            
            <a href="/">about</a>
            
            <a href="/">archives</a>
            
            </div>
        </div>
    </div>
</div>




<div id="post" class="center">

    <p class="time">January 16, 2014</p> 

    <h1 class="title">补码之美</h1>

    <div class="content"><p><img src="https://f.cloud.github.com/assets/97227/1930987/80308c3e-7eb7-11e3-9880-9de6cbe627c1.png" alt="screen shot 2014-01-16 at 9 59 26 pm"></p>
<p>在计算机中，为什么 -1 要用补码表示为 1111 ?</p>
<p>首先要了解 CPU 的基本单元 ALU 模块。在 ALU 里，加法是最基本的运算。通过程序，乘法可以转换为加分，除法可以转换为减法。补码表示，则可以让减法直接转换为加法。这样，ALU 核心只需要加法器就好，加法器可以通过集成电路中的晶体管来实现。</p>
<p>要将减法转换为加法，在数学公式里，只要加一个括号即可：</p>
<pre><code><span class="hljs-keyword">X</span> - <span class="hljs-keyword">Y</span> = <span class="hljs-keyword">X</span> + (-<span class="hljs-keyword">Y</span>)
</code></pre><p>在 CPU 里，如果想让加法器具备减法功能，核心是负数如何表示。</p>
<h2 id="原码">原码</h2><p>大自然赐予了我们硅，硅是很稳定的半导体，通过 PN 结等精细工艺，可以做成各种晶体管。在晶体管的世界里，基本状态只有 on 和 off 两种，也就是只有 
1 和 0。于是，在计算机里，我们采用二进制来表示整数。</p>
<p>这样，最自然的想法是，对于正整数来说，直接从十进制转换成二进制就好。比如 1 用 0001 来表示，2 用 0010 来表示。</p>
<p>负整数怎么来表示呢？增加一个符号位来表示？比如二进制的最高位为 0 时表示正数，为 1 时则表示负数。</p>
<p>这样，-1 用 1001 表示，-2 用 1010 表示。这就是原码的概念。</p>
<p>在原码的表示里：</p>
<pre><code><span class="hljs-symbol">1 </span>- <span class="hljs-number">1</span> = <span class="hljs-number">1</span> + (-<span class="hljs-number">1</span>) = <span class="hljs-number">0001</span> + <span class="hljs-number">1001</span> = <span class="hljs-number">1010</span> = -<span class="hljs-number">2</span>
</code></pre><p>显然，原码表示法，不能把减法变成加法，悲催。</p>
<h2 id="补码">补码</h2><p>据说，所有科学问题，最后都是数学问题，而所有数学问题，最后都离不开哲学。</p>
<p>哲学太深奥了，我们来看看从数学上，如何把 X + (-Y) 转换成二进制相加。</p>
<p>我们希望有某种表示方法，使得 1 + (-1) = 0000  现在 1 用 0001 来表示，-1 应该怎么表示？</p>
<pre><code><span class="hljs-number">-1</span> = <span class="hljs-number">0000</span> - <span class="hljs-number">0001</span>
    = <span class="hljs-number">10000</span> - <span class="hljs-number">0001</span>  （高位借一）
    = (<span class="hljs-number">1111</span> + <span class="hljs-number">0001</span>) - <span class="hljs-number">0001</span>
    = (<span class="hljs-number">1111</span> - <span class="hljs-number">0001</span>) + <span class="hljs-number">0001</span>（第一步：取反）
    = <span class="hljs-number">1110</span> + <span class="hljs-number">0001</span>（第二步：加一）
    = <span class="hljs-number">1111</span>
</code></pre><p>也就是说，如果 -1 用 1111 来表示，则 1 + (-1) 的二进制表示通过加法就能进行减法操作，达成了我们最初的目的。</p>
<p>进一步，针对所有负整数：</p>
<pre><code>-<span class="ruby">Y = <span class="hljs-number">0000</span> - Y
</span>     =<span class="ruby"> (<span class="hljs-number">1111</span> + <span class="hljs-number">1</span> ) - Y
</span>     =<span class="ruby"> (<span class="hljs-number">1111</span> - Y) + <span class="hljs-number">1</span>   将正整数 Y 的二进制先取反、再加一</span>
</code></pre><p>整数转换成二进制后，先取反，再加一，这就是负整数的补码表示。正整数的补码跟原码一样。</p>
<p>到此为止，补码的前世今生就说完了，但还有些有意思的事情。</p>
<h2 id="简单之美">简单之美</h2><p>可以说，补码的出现，是为了能让 ALU 在设计时更简单：只需要加法电路就好，不需要减法电路。追求简单，极致的简单，这能给性能、工业化等带来很大价值。</p>
<p>再从数学上来看，整数遵循一些很容易被我们忽略的重要规律：</p>
<ol>
<li>数轴上，左边的数永远小于右边的数。比如 -8 &lt; -2 &lt; 0 &lt; 3 &lt; 5</li>
<li>数轴上，只有一个零。</li>
<li>相邻整数之间相差一。</li>
</ol>
<p>来看补码表示：</p>
<pre><code>    <span class="hljs-number">-8</span>      <span class="hljs-number">-7</span>         <span class="hljs-number">-6</span>        <span class="hljs-number">-5</span>        <span class="hljs-number">-4</span>        <span class="hljs-number">-3</span>       <span class="hljs-number">-2</span>      <span class="hljs-number">-1</span>       <span class="hljs-number">0</span>          <span class="hljs-number">1</span>         <span class="hljs-number">2</span>        <span class="hljs-number">3</span>         <span class="hljs-number">4</span>        <span class="hljs-number">5</span>         <span class="hljs-number">6</span>         <span class="hljs-number">7</span>
<span class="hljs-number">1000</span> | <span class="hljs-number">1001</span> |  <span class="hljs-number">1010</span> | <span class="hljs-number">1011</span> | <span class="hljs-number">1100</span> | <span class="hljs-number">1101</span> | <span class="hljs-number">1110</span> | <span class="hljs-number">1111</span> | <span class="hljs-number">0000</span> | <span class="hljs-number">0001</span> | <span class="hljs-number">0010</span> | <span class="hljs-number">0011</span> | <span class="hljs-number">0100</span> | <span class="hljs-number">0101</span> | <span class="hljs-number">0110</span> | <span class="hljs-number">0111</span>
</code></pre><ol>
<li>只看负数的补码表示，明显 1000 &lt; 1001，补码表示下，左边的负数很自然小于右边的负数。</li>
<li>很明显只有一个零，就是 0000，不存在 -0 跟 0 的表示不一样。</li>
<li>再看相邻整数之间，左边的整数加一，就是右边的整数，包括 1111 + 1 = 0000 。</li>
</ol>
<p>初看补码，有些怪异、不直观，但在二进制的世界里，补码是如此自然。第一个想出用补码来表示整数的人，真是个天才啊。</p>
<p>（完）</p>
<p>题图：世界有 10 种人：一种懂二进制，一种不懂。</p>
<hr>
<p>欢迎订阅 WTP（Web 技术与产品交流）微信公众帐号。WTP 关注技术、产品、自由梦，只推送原创文字。欢迎扫描二维码订阅：</p>
<p><img src="http://ww4.sinaimg.cn/thumbnail/68361562gw1e2iehwolnpj.jpg" alt=""></p>
</div>

    <div class="cat">
    
    <p><span>#</span> <a href="/category/blog/">blog</a></p>
    
    </div>

    <div class="relate">
        
        
        <p><span>PREV: </span><a rel="prev" href="/posts/25798517.html">QCon 出品人采访稿</a></p>
        

        
        
        <p><span>NEXT: </span><a rel="next" href="/posts/25724757.html">我感受到的阿里</a></p>
        

        <p><span></span><a rel="all" href="/">VIEW ALL POSTS</a></p>
    </div>

    <div class="comments">
        <div id="disqus_thread"></div>
    </div>

</div>


<div class="footer">
    <div class="center">
        made by AcyOrt / powered by <a target="_blank" href="https://github.com/AcyOrt/acyort">AcyOrt</a> / <a target="_blank" href="/rss.xml">RSS</a>
    </div>
</div>

<script>

var menu = document.querySelector('.menu');

document.querySelector('.main').addEventListener('click', function(e) {
    if (e.target.classList.toString().indexOf('menuicon') > -1) {
        return menu.classList.toggle('active')
    } 

    return menu.classList.remove('active')
})

</script>




<script>
(function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//acyort.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>



</div>

</body>
</html>
