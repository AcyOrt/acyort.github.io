<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="A simple blog framework. Powered by GitHub and NodeJS" />
<link rel="stylesheet" href="/css/style.css" />

<title>
CI deploy - AcyOrt
</title>
</head>

<body>

<div class="header">
  <div class="center">
    <div class="menu">
      <a class="logo" href="/">AcyOrt</a>
      <a class="github" target="_blank" href="https://github.com/acyortjs/acyort/"></a>
      
      <a class="normal" href="/docs/">Docs</a>
      
      <a class="normal" href="/api/">API</a>
      
      <a class="normal" href="/deploy/">Deploy</a>
      
      <a class="normal" target="_blank" href="https://github.com/acyortjs/acyortjs.github.io/issues">Source</a>
    </div>
    <div class="mobile-menu">
      
      <a href="/docs/">Docs</a>
      
      <a href="/api/">API</a>
      
      <a href="/deploy/">Deploy</a>
      
      <a target="_blank" href="https://github.com/acyortjs/acyortjs.github.io/issues">Source</a>
    </div>
    <div class="language">
      <select>
        <option>English</option>
      </select>
      <div id="toggle"></div>
    </div>
  </div>
</div>



<div class="banner">
  <div class="center">CI deploy</div>
</div>

<div class="center main">
  <div class="nav">
    <div class="stay">
      

      
    </div>
  </div>

  <div class="content markdown">
    <p>By integrating Github webhooks and CircleCI, your website can be deploy automatically after finishing writing.</p>
<p>Once auto deploy is set correctly, the only thing you need to do to add a new post is to open a browser and write an issue.</p>
<p><strong>How it works</strong></p>
<p>The schematic. And there is a demo <a href="https://github.com/LoeiFy/Recordum/">repository</a></p>
<p><img src="https://user-images.githubusercontent.com/2193211/35319242-eebaa61a-0119-11e8-87ee-339d984d4f05.png" alt="ci"></p>
<p><strong>How to do</strong></p>
<h2 id="briefsteps">Brief steps</h2><ul>
<li>A CircleCI API token</li><li>A GitHub repo</li><li>Two GitHub access tokens</li><li>Config CircleCI</li><li>Config Github repo</li></ul>
<h2 id="detailprocedures">Detail procedures</h2><h3 id="circlecitoken">CircleCI Token</h3><p>Login <a href="https://circleci.com">CircleCI</a> via GitHub, get CircleCI <a href="https://circleci.com/account/api">token</a>, named <code>ci-token</code></p>
<h3 id="githubtokens">GitHub Tokens</h3><p>Login GitHub, goto access <a href="https://github.com/settings/tokens">token</a> page, create two tokens:</p>
<ul>
<li>The token without any rights, named <code>read-token</code></li><li>The token with only <code>public_repo</code> right, named <code>repo-token</code></li></ul>
<h3 id="githubrepository">GitHub repository</h3><p>There should be two branches in the repository</p>
<p><strong>master branch</strong> </p>
<p>CircleCI and AcyOrt config files will be put in this branch. The folders structure:</p>

        <div class="hljs">
          <pre>.
├─ .circleci
├  └─ config.yml
└─ config.yml</pre>
        </div>
      
        <div class="hljs yml">
          <pre><span class="hljs-comment"># .circleci/config.yml</span>
version: <span class="hljs-number">2</span>
jobs:
  build:
    docker:
      - image: node:latest

    working_directory: ~/acyort

    branches:
      only:
        - master <span class="hljs-comment"># config branch</span>

    steps:
      - checkout
      - <span class="hljs-keyword">run</span><span class="bash">: npm install acyort -g
</span>      - <span class="hljs-keyword">run</span><span class="bash">: acyort init 
</span>      - <span class="hljs-keyword">run</span><span class="bash">: cp config.bak.yml config.yml 
</span>      - <span class="hljs-keyword">run</span><span class="bash">: acyort build  
</span>      - <span class="hljs-keyword">run</span><span class="bash">: git checkout .  
</span>      - <span class="hljs-keyword">run</span><span class="bash">: git checkout gh-pages <span class="hljs-comment"># static files branch</span>
</span>      - <span class="hljs-keyword">run</span><span class="bash">: git reset --hard origin/gh-pages
</span>      - <span class="hljs-keyword">run</span><span class="bash">: cp -R public/* . 
</span>      - <span class="hljs-keyword">run</span><span class="bash">: rm config.bak.yml 
</span>      - <span class="hljs-keyword">run</span><span class="bash">: rm -R scripts themes public 
</span>      - <span class="hljs-keyword">run</span><span class="bash">: git add .
</span>      - <span class="hljs-keyword">run</span><span class="bash">: git config user.name <span class="hljs-string">"username"</span> <span class="hljs-comment"># your GitHub username</span>
</span>      - <span class="hljs-keyword">run</span><span class="bash">: git config user.email <span class="hljs-string">"email"</span> <span class="hljs-comment"># your GitHub email</span>
</span>      - <span class="hljs-keyword">run</span><span class="bash">: git commit -m <span class="hljs-string">"Updated by circleci - `date`"</span>
</span>      <span class="hljs-comment"># fill your usename, repository below </span>
      - <span class="hljs-keyword">run</span><span class="bash">: git push -q https://<span class="hljs-variable">${gh_token}</span>@github.com/username/repository.git gh-pages:gh-pages</span></pre>
        </div>
      <hr>

        <div class="hljs yml">
          <pre><span class="hljs-comment"># config.yml</span>
<span class="hljs-comment"># only show important fields</span>

<span class="hljs-attr">user:</span>  <span class="hljs-comment"># set your GitHub username</span>
<span class="hljs-attr">repository:</span>  <span class="hljs-comment"># set your GitHub repository</span>

<span class="hljs-attr">public_dir:</span> <span class="hljs-string">public</span> <span class="hljs-comment"># important, same as CircleCi config: public</span>
<span class="hljs-attr">timezone:</span>  <span class="hljs-comment"># set your timezone</span>
<span class="hljs-attr">token:</span>  <span class="hljs-comment"># your `read-token` from github</span></pre>
        </div>
      <p><strong>gh-pages branch</strong> </p>
<p>it <strong>must</strong> exist. generated static files will be put in this branch. CNAME file should be put here if there is one.</p>
<h3 id="circlecisettings">CircleCI settings</h3><p>Login CircleCI, click PROJECTS, add the repo above, select platform <code>Linux &amp; Node</code>, click Start building. (It will fail because of missing token)</p>
<ul>
<li>Add Environment variables, key: <code>gh_token</code> value: <code>repo-token</code></li><li>In Advanced settings, set <code>Github Status updates</code> and <code>Build forked pull requests</code> off</li></ul>
<h3 id="repositorysettings">Repository settings</h3><p>Login GiHub, goto repository settings page, add webhooks</p>
<p><strong>Set Payload URL</strong></p>
<p>CircleCI build trigger API is <code>/project/:vas-type/:username/:project/tree/:branch</code>. so, webhook URL will be something like <code>https://circleci.com/api/v1.1/project/github/username/repository/tree/master?circle-token=ci-token</code></p>
<ul>
<li><code>username</code>: your GitHub username</li><li><code>repository</code>: your GitHub repository</li><li><code>ci-token</code>: the <code>ci-token</code> you get just now</li></ul>
<p><strong>Select Content type</strong></p>
<p>Use <code>application/json</code></p>
<p><strong>Select Trigger events</strong> </p>
<p>On <code>Let me select individual events</code>, only check the <code>Issues</code> field</p>
<h2 id="finally">Finally</h2><p>Enjoy writing on Github issues.</p>


    
  </div>

  <div class="toc">
    <div class="stay">
      
      
      <p>Contents</p>
      <ul>
<li><a href="#briefsteps">Brief steps</a></li><li><a href="#detailprocedures">Detail procedures</a><ul>
<li><a href="#circlecitoken">CircleCI Token</a></li><li><a href="#githubtokens">GitHub Tokens</a></li><li><a href="#githubrepository">GitHub repository</a></li><li><a href="#circlecisettings">CircleCI settings</a></li><li><a href="#repositorysettings">Repository settings</a></li></ul>
</li><li><a href="#finally">Finally</a></li></ul>

      
    </div>
  </div>
</div>


<div class="footer">
  <div class="center">
    <div class="copy">
      &copy; 2018 .
      <span>Made by AcyOrt</span> .
      <span>Inspiration by Hexo</span>
    </div>
    <p>Last updated: February 08, 2018</p>
    <a href="#" class="top">Top</a>
  </div>
</div>



<script src="/js/script.js"></script>


</body>
</html>
